#!/bin/zsh

####################################################################
####    														####
####    Значительно доработанный скрипт, теперь рекламные		####
####    файлы могут называться как угодно, и даже быть			####
####    в любом аудиоформате, скрипт даже подхватит их сразу    ####
####															####
####################################################################

AD_COUNTER=1 # счетчик рекламных файлов
AD_CATALOGUE='/home/player/ads'
MUSIC_CATALOGUE='/home/player/music'

while true ; do

  q=`date +%H`				# который час?
  s=`ls /home/player/music | shuf -n1`  # выбираем случайный файл из директории

    if [[ "$q" -ge "10" && "$q" -le "20" ]] ; then	    # музыка должна воспроизводиться с 10:00 до 21:00 ежедневно
        mpg123 -q $MUSIC_CATALOGUE/$s					# Воспроизводим музыкальную композицию
        sleep 15										# немного психологической разгрузки продавцам, у которых эта музыка уже вона где =)
    
	    # Врубаем рекламу
		declare -a CURRENT_FILE=(`ls`)		# Здесь массив имён файлов
		mpg123 -q $AD_CATALOGUE/$CURRENT_FILE[$AD_COUNTER]

		# Стандартная рутина со счётчиками
		# Если дошли до конца списка файлов, то возвращаемся к первому
		if [[ $AD_COUNTER -lt `ls -1 | wc -l` ]] ; then 
			let  "AD_COUNTER = AD_COUNTER + 1"
		else
			AD_COUNTER=1
		fi
   
    sleep 15			# Еще лучей добра продавцам
	
	else sleep 3600
  fi
done
